<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Domain Mapping 4.3.0.4: C:/Users/Aaron/OneDrive/wpms.network/CurrentSetup/wp-content/plugins/domain-mapping/classes/Domainmap/Reseller/Enom.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Domain Mapping 4.3.0.4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_enom_8php_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Enom.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_enom_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// +----------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// | Copyright Incsub (http://incsub.com/)                                |</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// | Based on an original by Donncha (http://ocaoimh.ie/)                 |</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// +----------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// | This program is free software; you can redistribute it and/or modify |</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// | it under the terms of the GNU General Public License, version 2, as  |</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// | published by the Free Software Foundation.                           |</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// |                                                                      |</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// | This program is distributed in the hope that it will be useful,      |</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// | but WITHOUT ANY WARRANTY; without even the implied warranty of       |</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        |</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// | GNU General Public License for more details.                         |</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// |                                                                      |</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// | You should have received a copy of the GNU General Public License    |</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// | along with this program; if not, write to the Free Software          |</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// | Foundation, Inc., 51 Franklin St, Fifth Floor, Boston,               |</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// | MA 02110-1301 USA                                                    |</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// +----------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html">   30</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_domainmap___reseller___enom.html">Domainmap_Reseller_Enom</a> <span class="keyword">extends</span> <a class="code" href="class_domainmap___reseller.html">Domainmap_Reseller</a> {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a6d9d81b65364da06588e5a7aa028eb92">   32</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a6d9d81b65364da06588e5a7aa028eb92">RESELLER_ID</a> = <span class="stringliteral">&#39;enom&#39;</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a450dd6b6bcd430855be105cfa310f23b">   34</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a450dd6b6bcd430855be105cfa310f23b">ENDPOINT_PRODUCTION</a> = <span class="stringliteral">&#39;https://reseller.enom.com/interface.asp?&#39;</span>;</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a82039a37711a6e0c9d2ccdae6ce15a48">   35</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a82039a37711a6e0c9d2ccdae6ce15a48">ENDPOINT_TEST</a>       = <span class="stringliteral">&#39;https://resellertest.enom.com/interface.asp?&#39;</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a92c4451df2f2646c9402f158c142f073">   36</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a92c4451df2f2646c9402f158c142f073">ENDPOINT_PROXY</a>      = <span class="stringliteral">&#39;http://premium.wpmudev.org/enom-proxy.php?&#39;</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a85e894618e7beaa3d8eae1a30746d6a6">   38</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a85e894618e7beaa3d8eae1a30746d6a6">ENVIRONMENT_PRODUCTION</a> = <span class="stringliteral">&#39;prod&#39;</span>;</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a8304c6c09176f9b996cb8312612187b6">   39</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a8304c6c09176f9b996cb8312612187b6">ENVIRONMENT_TEST</a>       = <span class="stringliteral">&#39;test&#39;</span>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a449a3aa26a4613349987d1fb390ca040">   41</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a449a3aa26a4613349987d1fb390ca040">COMMAND_CHECK_LOGIN</a>        = <span class="stringliteral">&#39;CheckLogin&#39;</span>;</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a233cda1feaa3a3ba0520001dada54cc0">   42</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a233cda1feaa3a3ba0520001dada54cc0">COMMAND_CHECK</a>              = <span class="stringliteral">&#39;Check&#39;</span>;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#aac4e1a507ab6024d478dfdedbf1924f2">   43</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#aac4e1a507ab6024d478dfdedbf1924f2">COMMAND_GET_TLD_LIST</a>       = <span class="stringliteral">&#39;GetTLDList&#39;</span>;</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#ac66c64ce90007f2a45883ac1dd547c6b">   44</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#ac66c64ce90007f2a45883ac1dd547c6b">COMMAND_RETAIL_PRICE</a>       = <span class="stringliteral">&#39;PE_GetRetailPrice&#39;</span>;</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#afeb28537012175f202d750fb8b658e56">   45</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#afeb28537012175f202d750fb8b658e56">COMMAND_PURCHASE</a>           = <span class="stringliteral">&#39;Purchase&#39;</span>;</div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a8c9cb5020d8eaa0db4927b77a1d65127">   46</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a8c9cb5020d8eaa0db4927b77a1d65127">COMMAND_SET_HOSTS</a>          = <span class="stringliteral">&#39;SetHosts&#39;</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#add5dc69ffd7a875d957270d68f4dc85d">   47</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#add5dc69ffd7a875d957270d68f4dc85d">COMMAND_GET_EXT_ATTRIBUTES</a> = <span class="stringliteral">&#39;GetExtAttributes&#39;</span>;</div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#ae801d329add65a635dfe3662adbb6e96">   48</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#ae801d329add65a635dfe3662adbb6e96">COMMAND_REGISTER_ACCOUNT</a>   = <span class="stringliteral">&#39;CreateAccount&#39;</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a068df92d9e337b6c4784bbacaed60504">   50</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a068df92d9e337b6c4784bbacaed60504">GATEWAY_ENOM</a>     = <span class="stringliteral">&#39;enom&#39;</span>;</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a78f5f806a4437d5af738fb00ce81d493">   51</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___reseller___enom.html#a78f5f806a4437d5af738fb00ce81d493">GATEWAY_PROSITES</a> = <span class="stringliteral">&#39;prosites&#39;</span>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#ad66b4ad776c342e9b491e68ba7d1867b">   60</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#ad66b4ad776c342e9b491e68ba7d1867b">get_reseller_id</a>() {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">return</span> self::RESELLER_ID;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _exec_command( $command, $args = array(), $endpoint = <span class="keyword">false</span> ) {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        $options = <a class="code" href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin::instance</a>()-&gt;get_options();</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">if</span> ( !isset( $args[<span class="stringliteral">&#39;uid&#39;</span>] ) || !isset( $args[<span class="stringliteral">&#39;pw&#39;</span>] ) ) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <span class="keywordflow">if</span> ( !isset( $args[<span class="stringliteral">&#39;uid&#39;</span>] ) ) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                $args[<span class="stringliteral">&#39;uid&#39;</span>] = isset( $options[self::RESELLER_ID][<span class="stringliteral">&#39;uid&#39;</span>] ) ? $options[self::RESELLER_ID][<span class="stringliteral">&#39;uid&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordflow">if</span> ( !isset( $args[<span class="stringliteral">&#39;pw&#39;</span>] ) ) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                $args[<span class="stringliteral">&#39;pw&#39;</span>] = isset( $options[self::RESELLER_ID][<span class="stringliteral">&#39;pwd&#39;</span>] ) ? $options[self::RESELLER_ID][<span class="stringliteral">&#39;pwd&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">if</span> ( !isset( $args[<span class="stringliteral">&#39;responsetype&#39;</span>] ) ) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            $args[<span class="stringliteral">&#39;responsetype&#39;</span>] = <span class="stringliteral">&#39;xml&#39;</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        $args[<span class="stringliteral">&#39;command&#39;</span>] = $command;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">if</span> ( !$endpoint ) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            $endpoint = $this-&gt;_get_environment() == self::ENVIRONMENT_PRODUCTION ? self::ENDPOINT_PRODUCTION : self::ENDPOINT_TEST;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        $sslverify = !isset( $options[self::RESELLER_ID][<span class="stringliteral">&#39;sslverification&#39;</span>] ) || $options[self::RESELLER_ID][<span class="stringliteral">&#39;sslverification&#39;</span>] == 1;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        $response = wp_remote_get( $endpoint . http_build_query( $args ), array( <span class="stringliteral">&#39;sslverify&#39;</span> =&gt; $sslverify ) );</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">if</span> ( is_wp_error( $response ) ) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keywordflow">return</span> $response;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        $response_code = wp_remote_retrieve_response_code( $response );</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        $response_body = wp_remote_retrieve_body( $response );</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">if</span> ( $response_code != 200 ) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            $error = <span class="keyword">new</span> WP_Error();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            $error-&gt;add( $response_code, strip_tags( $response_body ) );</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">return</span> $error;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        libxml_use_internal_errors( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">return</span> simplexml_load_string( $response_body );</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _log_enom_request( $type, $xml ) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">if</span> ( !is_object( $xml ) ) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        $valid = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        $errors = array();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span> ( is_wp_error( $xml ) ) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            $errors = $xml-&gt;get_error_messages();</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            $xml = array();</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        } elseif ( is_a( $xml, <span class="stringliteral">&#39;SimpleXMLElement&#39;</span> ) ) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            $valid = !isset( $xml-&gt;ErrCount ) || $xml-&gt;ErrCount == 0;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">if</span> ( !$valid &amp;&amp; isset( $xml-&gt;errors ) ) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                $errors = json_decode( json_encode( $xml-&gt;errors ), <span class="keyword">true</span> );</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            $errors[] = __( <span class="stringliteral">&#39;Unexpected error appears during request processing. Please, try again later.&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> );</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">if</span> ( filter_input( INPUT_GET, <span class="stringliteral">&#39;debug&#39;</span> ) ) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                $errors[] = $xml;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___reseller.html#a8e39ae31a98607442483e508edd072f4">_log_request</a>( $type, $valid, $errors, $xml );</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#ad0a7aed24a1a1d3be1f463feb191f46f">  159</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#ad0a7aed24a1a1d3be1f463feb191f46f">save_options</a>( &amp;$options ) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">if</span> ( !isset( $options[self::RESELLER_ID] ) || !is_array( $options[self::RESELLER_ID] ) ) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            $options[self::RESELLER_ID] = array();</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="comment">// user name</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        $uid = trim( filter_input( INPUT_POST, <span class="stringliteral">&#39;map_reseller_enom_uid&#39;</span> ) );</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        $need_health_check = !isset( $options[self::RESELLER_ID][<span class="stringliteral">&#39;uid&#39;</span>] ) || $options[self::RESELLER_ID][<span class="stringliteral">&#39;uid&#39;</span>] != $uid;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        $options[self::RESELLER_ID][<span class="stringliteral">&#39;uid&#39;</span>] = $uid;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">// password</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        $pwd = filter_input( INPUT_POST, <span class="stringliteral">&#39;map_reseller_enom_pwd&#39;</span> );</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        $pwd_hash = filter_input( INPUT_POST, <span class="stringliteral">&#39;map_reseller_enom_pwd_hash&#39;</span> );</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">if</span> ( $pwd_hash != sha1( $pwd ) ) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            $options[self::RESELLER_ID][<span class="stringliteral">&#39;pwd&#39;</span>] = $pwd;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            $need_health_check = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="comment">// payment gateway</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        $gateway = filter_input( INPUT_POST, <span class="stringliteral">&#39;map_reseller_enom_payment&#39;</span> );</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span> ( $gateway !== <span class="keyword">false</span> ) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            $gateways = $this-&gt;_get_gateways();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordflow">if</span> ( isset( $gateways[$gateway] ) ) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                $options[self::RESELLER_ID][<span class="stringliteral">&#39;gateway&#39;</span>] = $gateway;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">// environment</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        $environment = filter_input( INPUT_POST, <span class="stringliteral">&#39;map_reseller_enom_environment&#39;</span> );</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> ( in_array( $environment, array( self::ENVIRONMENT_PRODUCTION, self::ENVIRONMENT_TEST ) ) ) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            $options[self::RESELLER_ID][<span class="stringliteral">&#39;environment&#39;</span>] = $environment;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment">// ssl verification</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        $options[self::RESELLER_ID][<span class="stringliteral">&#39;sslverification&#39;</span>] = (int)filter_input( INPUT_POST, <span class="stringliteral">&#39;map_reseller_enom_sslverification&#39;</span>, FILTER_VALIDATE_BOOLEAN );</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="comment">// validate credentials</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        $options[self::RESELLER_ID][<span class="stringliteral">&#39;valid&#39;</span>] = $need_health_check || ( isset( $options[self::RESELLER_ID][<span class="stringliteral">&#39;valid&#39;</span>], $options[self::RESELLER_ID][<span class="stringliteral">&#39;uid&#39;</span>], $options[self::RESELLER_ID][<span class="stringliteral">&#39;pwd&#39;</span>] ) &amp;&amp; $options[self::RESELLER_ID][<span class="stringliteral">&#39;valid&#39;</span>] == false )</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            ? $this-&gt;_validate_credentials( $options[self::RESELLER_ID][<span class="stringliteral">&#39;uid&#39;</span>], $options[self::RESELLER_ID][<span class="stringliteral">&#39;pwd&#39;</span>], $options[self::RESELLER_ID][<span class="stringliteral">&#39;environment&#39;</span>] )</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            : <span class="keyword">true</span>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _validate_credentials( $uid, $pwd, $environment ) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        $endpoint = $environment == self::ENVIRONMENT_PRODUCTION</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            ? self::ENDPOINT_PRODUCTION</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            : self::ENDPOINT_TEST;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        $xml = $this-&gt;_exec_command( self::COMMAND_CHECK_LOGIN, array(</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="stringliteral">&#39;uid&#39;</span> =&gt; $uid,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="stringliteral">&#39;pw&#39;</span>  =&gt; $pwd,</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        ), $endpoint );</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        $this-&gt;_log_enom_request( self::REQUEST_VALIDATE_CREDENTIALS, $xml );</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        $transient = <span class="stringliteral">&#39;enom_errors_&#39;</span> . get_current_user_id();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        $valid = !isset( $xml-&gt;ErrCount ) || $xml-&gt;ErrCount == 0;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordflow">if</span> ( !$valid ) {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            set_site_transient( $transient, $this-&gt;<a class="code" href="class_domainmap___reseller.html#a675e17edda17e5a7b4bfb6fc16247f7f">get_last_errors</a>() );</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            delete_site_transient( $transient );</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">return</span> $valid;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _get_gateways() {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        global $psts;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        $gateways = array( self::GATEWAY_ENOM =&gt; esc_html__( <span class="stringliteral">&#39;eNom credit card processing services&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> ) );</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment">// add ProSites paypal gateway if the plugin is activated</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">if</span> ( $psts &amp;&amp; in_array( <span class="stringliteral">&#39;ProSites_Gateway_PayPalExpressPro&#39;</span>, $psts-&gt;get_setting( <span class="stringliteral">&#39;gateways_enabled&#39;</span> ) ) ) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            $gateways[self::GATEWAY_PROSITES] = esc_html__( <span class="stringliteral">&#39;Pro Sites PayPal payment gateway&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> );</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">return</span> $gateways;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _get_gateway( $options = null ) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        global $psts;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">// if no options were passed, take it from the plugin instance</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span> ( !$options ) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            $options = <a class="code" href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin::instance</a>()-&gt;get_options();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            $options = isset( $options[self::RESELLER_ID] ) ? $options[self::RESELLER_ID] : array();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="comment">// fetch gateway information</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        $gateways = $this-&gt;_get_gateways();</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        $gateway = isset( $options[<span class="stringliteral">&#39;gateway&#39;</span>] ) &amp;&amp; isset( $gateways[$options[<span class="stringliteral">&#39;gateway&#39;</span>]] )</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            ? $options[<span class="stringliteral">&#39;gateway&#39;</span>]</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            : self::GATEWAY_ENOM;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">// if paypal gateway is selected, then check if it is available</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">if</span> ( $gateway == self::GATEWAY_PROSITES ) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="comment">// if prosites or paypal gateway is not activated, then use eNom gateway</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            $paypal_class = <span class="stringliteral">&#39;ProSites_Gateway_PayPalExpressPro&#39;</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">if</span> ( !$psts || !in_array( $paypal_class, (array)$psts-&gt;get_setting( <span class="stringliteral">&#39;gateways_enabled&#39;</span> ) ) || !class_exists( $paypal_class ) ) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                $gateway = self::GATEWAY_ENOM;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">return</span> $gateway;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _get_environment( $options = null ) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">// if no options were passed, take it from the plugin instance</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">if</span> ( !$options ) {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            $options = <a class="code" href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin::instance</a>()-&gt;get_options();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            $options = isset( $options[self::RESELLER_ID] ) ? $options[self::RESELLER_ID] : array();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">return</span> isset( $options[<span class="stringliteral">&#39;environment&#39;</span>] ) ? $options[<span class="stringliteral">&#39;environment&#39;</span>] : self::ENVIRONMENT_TEST;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#ac01f0421cdf853d8bdac45fcd181dc28">  321</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#ac01f0421cdf853d8bdac45fcd181dc28">get_title</a>() {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;eNom&#39;</span>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#add93e09651b78e81b6efc3c38b079452">  332</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#add93e09651b78e81b6efc3c38b079452">render_options</a>() {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        $options = <a class="code" href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin::instance</a>()-&gt;get_options();</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        $options = isset( $options[self::RESELLER_ID] ) ? $options[self::RESELLER_ID] : array();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        $register_link = add_query_arg( array(</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="stringliteral">&#39;action&#39;</span>   =&gt; <a class="code" href="class_domainmap___plugin.html#a0c4e33c65e6c007606223ad5211f7e91">Domainmap_Plugin::ACTION_SHOW_REGISTRATION_FORM</a>,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="stringliteral">&#39;nonce&#39;</span>    =&gt; wp_create_nonce( <a class="code" href="class_domainmap___plugin.html#a0c4e33c65e6c007606223ad5211f7e91">Domainmap_Plugin::ACTION_SHOW_REGISTRATION_FORM</a> ),</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="stringliteral">&#39;reseller&#39;</span> =&gt; self::encode_reseller_class( __CLASS__ ),</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        ), admin_url( <span class="stringliteral">&#39;admin-ajax.php&#39;</span> ) );</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        $template = <span class="keyword">new</span> <a class="code" href="class_domainmap___render___reseller___enom___settings.html">Domainmap_Render_Reseller_Enom_Settings</a>( $options );</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        $template-&gt;gateways = $this-&gt;_get_gateways();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        $template-&gt;gateway = $this-&gt;_get_gateway( $options );</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        $template-&gt;environment = $this-&gt;_get_environment( $options );</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        $template-&gt;register_link = $register_link;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        $template-&gt;errors = get_site_transient( <span class="stringliteral">&#39;enom_errors_&#39;</span> . get_current_user_id() );</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        $template-&gt;render();</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a99a2e93fb647b699371cb19e2d28915b">  361</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#a99a2e93fb647b699371cb19e2d28915b">is_valid</a>() {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        $options = <a class="code" href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin::instance</a>()-&gt;get_options();</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">return</span> !isset( $options[self::RESELLER_ID][<span class="stringliteral">&#39;valid&#39;</span>] ) || $options[self::RESELLER_ID][<span class="stringliteral">&#39;valid&#39;</span>] == <span class="keyword">true</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#aa601dc907edd97e9f80b1554b6d46ea0">  374</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#aa601dc907edd97e9f80b1554b6d46ea0">_get_tld_list</a>() {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        $xml = $this-&gt;_exec_command( self::COMMAND_GET_TLD_LIST );</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        $this-&gt;_log_enom_request( self::REQUEST_GET_TLD_LIST, $xml );</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        $tlds = array();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">if</span> ( $xml &amp;&amp; isset($xml-&gt;tldlist, $xml-&gt;tldlist-&gt;tld ) ) {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            $tldlist = json_decode( json_encode( $xml-&gt;tldlist ), <span class="keyword">true</span> );</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">foreach</span> ( $tldlist[<span class="stringliteral">&#39;tld&#39;</span>] as $tld ) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                $tlds[] = $tld[<span class="stringliteral">&#39;tld&#39;</span>];</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">return</span> array_filter( $tlds );</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#ac47d461c9dbf0016d01fb5ed014f5856">  399</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#ac47d461c9dbf0016d01fb5ed014f5856">_check_domain</a>( $tld, $sld ) {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        $xml = $this-&gt;_exec_command( self::COMMAND_CHECK, array(</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="stringliteral">&#39;tld&#39;</span> =&gt; $tld,</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="stringliteral">&#39;sld&#39;</span> =&gt; $sld,</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        ) );</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        $this-&gt;_log_enom_request( self::REQUEST_CHECK_DOMAIN, $xml );</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">return</span> $xml &amp;&amp; isset( $xml-&gt;RRPCode ) &amp;&amp; $xml-&gt;RRPCode == 210;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#aca7c0095ca2291aceadb87c846cd1600">  420</a></span>&#160;    <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#aca7c0095ca2291aceadb87c846cd1600">_get_tld_price</a>( $tld, $period ) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        $xml = $this-&gt;_exec_command( self::COMMAND_RETAIL_PRICE, array(</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="stringliteral">&#39;tld&#39;</span>         =&gt; $tld,</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="stringliteral">&#39;ProductType&#39;</span> =&gt; 10,</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        ) );</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        $this-&gt;_log_enom_request( self::REQUEST_GET_RETAIL_PRICE, $xml );</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">if</span> ( $xml &amp;&amp; isset( $xml-&gt;productprice-&gt;price ) ) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="keywordflow">return</span> floatval( $xml-&gt;productprice-&gt;price );</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a1632cb752cdaa83181fe5341de96f422">  443</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#a1632cb752cdaa83181fe5341de96f422">purchase</a>() {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        $sld = trim( filter_input( INPUT_POST, <span class="stringliteral">&#39;sld&#39;</span> ) );</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        $tld = trim( filter_input( INPUT_POST, <span class="stringliteral">&#39;tld&#39;</span> ) );</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        $expiry = array_map( <span class="stringliteral">&#39;trim&#39;</span>, explode( <span class="charliteral">&#39;/&#39;</span>, filter_input( INPUT_POST, <span class="stringliteral">&#39;card_expiration&#39;</span> ), 2 ) );</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        $billing_phone = <span class="charliteral">&#39;+&#39;</span> . preg_replace( <span class="stringliteral">&#39;/[^0-9\.]/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, filter_input( INPUT_POST, <span class="stringliteral">&#39;billing_phone&#39;</span> ) );</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        $registrant_phone = <span class="charliteral">&#39;+&#39;</span> . preg_replace( <span class="stringliteral">&#39;/[^0-9\.]/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_phone&#39;</span> ) );</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        $registrant_fax = <span class="charliteral">&#39;+&#39;</span> . preg_replace( <span class="stringliteral">&#39;/[^0-9\.]/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_fax&#39;</span> ) );</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        $response = $this-&gt;_exec_command( self::COMMAND_PURCHASE, array(</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                                                      <span class="stringliteral">&#39;sld&#39;</span>                        =&gt; $sld,</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                                                                      <span class="stringliteral">&#39;tld&#39;</span>                        =&gt; $tld,</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                                                      <span class="stringliteral">&#39;UseDNS&#39;</span>                     =&gt; <span class="stringliteral">&#39;default&#39;</span>,</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                                                                      <span class="stringliteral">&#39;ChargeAmount&#39;</span>               =&gt; $this-&gt;<a class="code" href="class_domainmap___reseller.html#ab75e4def898a80008c79720e1d271f37">get_tld_price</a>( $tld ),</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                                                      <span class="stringliteral">&#39;EndUserIP&#39;</span>                  =&gt; self::_get_remote_ip(),</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                                                      <span class="stringliteral">&#39;CardType&#39;</span>                   =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;card_type&#39;</span> ),</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                                                                      <span class="stringliteral">&#39;CCName&#39;</span>                     =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;card_cardholder&#39;</span> ),</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                                                      <span class="stringliteral">&#39;CreditCardNumber&#39;</span>           =&gt; preg_replace( <span class="stringliteral">&#39;/[^0-9]/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, filter_input( INPUT_POST, <span class="stringliteral">&#39;card_number&#39;</span> ) ),</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                                                      <span class="stringliteral">&#39;CreditCardExpMonth&#39;</span>         =&gt; $expiry[0],</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                                                      <span class="stringliteral">&#39;CreditCardExpYear&#39;</span>          =&gt; isset( $expiry[1] ) ? <span class="stringliteral">&quot;20{$expiry[1]}&quot;</span> : <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                                                                      <span class="stringliteral">&#39;CVV2&#39;</span>                       =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;card_cvv2&#39;</span> ),</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                                                      <span class="stringliteral">&#39;CCAddress&#39;</span>                  =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;billing_address&#39;</span> ),</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                                                                      <span class="stringliteral">&#39;CCCity&#39;</span>                     =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;billing_city&#39;</span> ),</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                                                      <span class="stringliteral">&#39;CCStateProvince&#39;</span>            =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;billing_state&#39;</span> ),</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                                                                      <span class="stringliteral">&#39;CCZip&#39;</span>                      =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;billing_zip&#39;</span> ),</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                                                      <span class="stringliteral">&#39;CCPhone&#39;</span>                    =&gt; $billing_phone,</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                                                      <span class="stringliteral">&#39;CCCountry&#39;</span>                  =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;billing_country&#39;</span> ),</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantFirstName&#39;</span>        =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_first_name&#39;</span> ),</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantLastName&#39;</span>         =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_last_name&#39;</span> ),</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantOrganizationName&#39;</span> =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_organization&#39;</span> ),</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantJobTitle&#39;</span>         =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_job_title&#39;</span> ),</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantAddress1&#39;</span>         =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_address1&#39;</span> ),</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantAddress2&#39;</span>         =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_address2&#39;</span> ),</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantCity&#39;</span>             =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_city&#39;</span> ),</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantStateProvince&#39;</span>    =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_state&#39;</span> ),</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantPostalCode&#39;</span>       =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_zip&#39;</span> ),</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantCountry&#39;</span>          =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_country&#39;</span> ),</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantEmailAddress&#39;</span>     =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_email&#39;</span> ),</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantPhone&#39;</span>            =&gt; $registrant_phone,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                                                      <span class="stringliteral">&#39;RegistrantFax&#39;</span>              =&gt; $registrant_fax,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                                                  ) + ( isset( $_POST[<span class="stringliteral">&#39;ExtendedAttributes&#39;</span>] ) ? (array)$_POST[<span class="stringliteral">&#39;ExtendedAttributes&#39;</span>] : array() ) );</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        $this-&gt;_log_enom_request( self::REQUEST_PURCHASE_DOMAIN, $response );</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">if</span> ( $response &amp;&amp; isset( $response-&gt;RRPCode ) &amp;&amp; $response-&gt;RRPCode == 200 ) {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            $this-&gt;_populate_dns_records( $tld, $sld );</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;{$sld}.{$tld}&quot;</span>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _populate_dns_records( $tld, $sld ) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        global <a class="code" href="sunrise_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, $blog_id;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        $ips = $args = array();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        $options = <a class="code" href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin::instance</a>()-&gt;get_options();</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="comment">// if server ip addresses are provided, use it to populate DNS records</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span> ( !empty( $options[<span class="stringliteral">&#39;map_ipaddress&#39;</span>] ) ) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="keywordflow">foreach</span> ( explode( <span class="charliteral">&#39;,&#39;</span>, trim( $options[<span class="stringliteral">&#39;map_ipaddress&#39;</span>] ) ) as $ip ) {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                <span class="keywordflow">if</span> ( filter_var( $ip, FILTER_VALIDATE_IP ) ) {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                    $ips[] = $ip;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">// looks like server ip addresses are not set, then try to read it automatically</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">if</span> ( empty( $ips ) &amp;&amp; function_exists( <span class="stringliteral">&#39;dns_get_record&#39;</span> ) ) {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="comment">// fetch unchanged domain name from database, because get_option function could return mapped domain name</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            $basedomain = parse_url( $wpdb-&gt;get_var( <span class="stringliteral">&quot;SELECT option_value FROM {$wpdb-&gt;options} WHERE option_name = &#39;siteurl&#39;&quot;</span> ), PHP_URL_HOST );</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            <span class="comment">// fetch domain DNS A records</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            $dns = @dns_get_record( $basedomain, DNS_A );</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keywordflow">if</span> ( is_array( $dns ) ) {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                $ips = wp_list_pluck( $dns, <span class="stringliteral">&#39;ip&#39;</span> );</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="comment">// if we have an ip address to populate DNS record, then try to detect if we use shared or dedicated hosting</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        $dedicated = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">if</span> ( !empty( $ips ) ) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            $check = sha1( time() );</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            switch_to_blog( 1 );</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            $ajax_url = admin_url( <span class="stringliteral">&#39;admin-ajax.php&#39;</span> );</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            $ajax_url = str_replace( parse_url( $ajax_url, PHP_URL_HOST ), current( $ips ), $ajax_url );</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            restore_current_blog();</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            $response = wp_remote_request( add_query_arg( array(</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                <span class="stringliteral">&#39;action&#39;</span> =&gt; <a class="code" href="class_domainmap___plugin.html#a2aa8435615e980dfaf2c95a8b9c0375f">Domainmap_Plugin::ACTION_HEARTBEAT_CHECK</a>,</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                <span class="stringliteral">&#39;check&#39;</span>  =&gt; $check,</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            ), $ajax_url ) );</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            $dedicated = !is_wp_error( $response ) &amp;&amp; wp_remote_retrieve_response_code( $response ) == 200 &amp;&amp; wp_remote_retrieve_body( $response ) == $check;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">// populate request arguments</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordflow">if</span> ( !empty( $ips ) &amp;&amp; $dedicated ) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="comment">// network is hosted on dedicated hosting and we can use DNS A records</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            $i = 0;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="keywordflow">foreach</span> ( $ips as $ip ) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <span class="keywordflow">if</span> ( filter_var( trim( $ip ), FILTER_VALIDATE_IP ) ) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                    $i++;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                    $args[<span class="stringliteral">&quot;HostName{$i}&quot;</span>] = <span class="charliteral">&#39;@&#39;</span>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                    $args[<span class="stringliteral">&quot;RecordType{$i}&quot;</span>] = <span class="charliteral">&#39;A&#39;</span>;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                    $args[<span class="stringliteral">&quot;Address{$i}&quot;</span>] = $ip;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="comment">// network is hosted on shared hosting and we can use DNS CNAME records for it</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            $origin = $wpdb-&gt;get_row( <span class="stringliteral">&quot;SELECT * FROM {$wpdb-&gt;blogs} WHERE blog_id = &quot;</span> . intval( $blog_id ) );</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            $args[<span class="stringliteral">&#39;HostName1&#39;</span>] = <span class="stringliteral">&quot;{$sld}.{$tld}&quot;</span>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            $args[<span class="stringliteral">&#39;RecordType1&#39;</span>] = <span class="stringliteral">&#39;CNAME&#39;</span>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            $args[<span class="stringliteral">&#39;Address1&#39;</span>] = <span class="stringliteral">&quot;{$origin-&gt;domain}.&quot;</span>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            $args[<span class="stringliteral">&#39;HostName2&#39;</span>] = <span class="stringliteral">&quot;www.{$sld}.{$tld}&quot;</span>;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            $args[<span class="stringliteral">&#39;RecordType2&#39;</span>] = <span class="stringliteral">&#39;CNAME&#39;</span>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            $args[<span class="stringliteral">&#39;Address2&#39;</span>] = <span class="stringliteral">&quot;{$origin-&gt;domain}.&quot;</span>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="comment">// setup DNS records if it has been populated</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">if</span> ( !empty( $args ) ) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            $args[<span class="stringliteral">&#39;sld&#39;</span>] = $sld;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            $args[<span class="stringliteral">&#39;tld&#39;</span>] = $tld;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            $response = $this-&gt;_exec_command( self::COMMAND_SET_HOSTS, $args );</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            $this-&gt;_log_enom_request( self::REQUEST_SET_DNS_RECORDS, $response );</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a438e9cc8f314cc4475020198db90947c">  593</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#a438e9cc8f314cc4475020198db90947c">render_purchase_form</a>( $domain_info ) {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        global $current_user;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        get_currentuserinfo();</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        $cardholder = trim( $current_user-&gt;user_firstname . <span class="charliteral">&#39; &#39;</span> . $current_user-&gt;user_lastname );</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">if</span> ( empty( $cardholder ) ) {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            $cardholder = __( <span class="stringliteral">&#39;Your name&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> );</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        $render = <span class="keyword">new</span> <a class="code" href="class_domainmap___render___reseller___enom___purchase.html">Domainmap_Render_Reseller_Enom_Purchase</a>( $domain_info );</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        $render-&gt;errors = $this-&gt;<a class="code" href="class_domainmap___reseller.html#a675e17edda17e5a7b4bfb6fc16247f7f">get_last_errors</a>();</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        $render-&gt;cardtypes = $this-&gt;<a class="code" href="class_domainmap___reseller.html#a9f67f9904a81a692e3cd145b40b282ce">get_card_types</a>();</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        $render-&gt;cardholder = $cardholder;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        $render-&gt;countries = <a class="code" href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin::instance</a>()-&gt;get_countries();</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        $render-&gt;ext_attributes = $this-&gt;_get_extended_attributes( $domain_info[<span class="stringliteral">&#39;tld&#39;</span>] );</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        $render-&gt;render();</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _get_extended_attributes( $tld ) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        $transient = <span class="stringliteral">&quot;domainmap-ext-attributes-{$tld}&quot;</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        $attributes = get_site_transient( $transient );</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keywordflow">if</span> ( $attributes !== <span class="keyword">false</span> ) {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">return</span> $attributes;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        $attributes = array();</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        $response = $this-&gt;_exec_command( self::COMMAND_GET_EXT_ATTRIBUTES, array( <span class="stringliteral">&#39;TLD&#39;</span> =&gt; $tld ) );</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        $this-&gt;_log_enom_request( self::REQUEST_GET_EXT_ATTRIBUTES, $response );</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        $response = json_decode( json_encode( $response ), <span class="keyword">true</span> );</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">if</span> ( !empty( $response[<span class="stringliteral">&#39;Attributes&#39;</span>][<span class="stringliteral">&#39;Attribute&#39;</span>] ) &amp;&amp; is_array( $response[<span class="stringliteral">&#39;Attributes&#39;</span>][<span class="stringliteral">&#39;Attribute&#39;</span>] ) ) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">foreach</span> ( $response[<span class="stringliteral">&#39;Attributes&#39;</span>][<span class="stringliteral">&#39;Attribute&#39;</span>] as $attribute ) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <span class="keywordflow">if</span> ( $attribute[<span class="stringliteral">&#39;Application&#39;</span>] == 2 ) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                    $attribute[<span class="stringliteral">&#39;Options&#39;</span>] = $attribute[<span class="stringliteral">&#39;Options&#39;</span>][<span class="stringliteral">&#39;Option&#39;</span>];</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                    $attributes[] = $attribute;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        set_site_transient( $transient, $attributes, DAY_IN_SECONDS );</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">return</span> $attributes;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a33cf6da9af003c5c5707d75614d6b22d">  658</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#a33cf6da9af003c5c5707d75614d6b22d">get_domain_available_response</a>( $sld, $tld, $purchase_link = <span class="keyword">false</span> ) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        global $psts;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keywordflow">if</span> ( $psts ) {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">if</span> ( $this-&gt;_get_gateway() == self::GATEWAY_PROSITES ) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                $locale = apply_filters( <span class="stringliteral">&#39;domainmap_locale&#39;</span>, get_locale() );</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                <span class="keywordflow">if</span> ( !preg_match( <span class="stringliteral">&#39;/^[a-z]{2}_[A-Z]{2}$/&#39;</span>, $locale ) ) {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                    $locale = <span class="stringliteral">&#39;en_US&#39;</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">return</span> parent::get_domain_available_response( $sld, $tld, sprintf( <span class="stringliteral">&#39;</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="stringliteral">                    &lt;form class=&quot;domainmapping-paypal-form&quot; action=&quot;%s&quot;&gt;</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="stringliteral">                        &lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;%s&quot;&gt;</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="stringliteral">                        &lt;input type=&quot;hidden&quot; name=&quot;nonce&quot; value=&quot;%s&quot;&gt;</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="stringliteral">                        &lt;input type=&quot;hidden&quot; name=&quot;sld&quot; value=&quot;%s&quot;&gt;</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="stringliteral">                        &lt;input type=&quot;hidden&quot; name=&quot;tld&quot; value=&quot;%s&quot;&gt;</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="stringliteral">                        &lt;button type=&quot;submit&quot; class=&quot;domainmapping-transparent-button&quot;&gt;&lt;img src=&quot;http://www.paypalobjects.com/%s/i/btn/btn_buynow_LG.gif&quot; alt=&quot;%s&quot;&gt;&lt;/button&gt;</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="stringliteral">                    &lt;/form&gt;</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="stringliteral">                    &#39;</span>,</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                    admin_url( <span class="stringliteral">&#39;admin-ajax.php&#39;</span> ),</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                    <a class="code" href="class_domainmap___plugin.html#ab093deb6caacb21da50b2a854d9da98e">Domainmap_Plugin::ACTION_PAYPAL_PURCHASE</a>,</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                    wp_create_nonce( <a class="code" href="class_domainmap___plugin.html#ab093deb6caacb21da50b2a854d9da98e">Domainmap_Plugin::ACTION_PAYPAL_PURCHASE</a> ),</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                    $sld,</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                    $tld,</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                    $locale,</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                    __( <span class="stringliteral">&#39;Purchase this domain with PayPal Express Checkout.&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> )</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                ) );</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="keywordflow">return</span> parent::get_domain_available_response( $sld, $tld, $purchase_link );</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _set_express_checkout( $amount, $sld, $tld ) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        global $psts;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">if</span> ( !$psts ) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        $returnurl = add_query_arg( array(</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="stringliteral">&#39;action&#39;</span> =&gt; <a class="code" href="class_domainmap___plugin.html#af6f2cc6311e8c59144fd2a21f0a186c5">Domainmap_Plugin::ACTION_PAYPAL_DO_EXPRESS_CHECKOUT</a>,</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            <span class="stringliteral">&#39;sld&#39;</span>    =&gt; $sld,</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <span class="stringliteral">&#39;tld&#39;</span>    =&gt; $tld,</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        ), admin_url( <span class="stringliteral">&#39;admin-ajax.php&#39;</span> ) );</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        $cancelurl = parse_url( add_query_arg( array(</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="stringliteral">&#39;token&#39;</span> =&gt; <span class="keyword">false</span>,</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="stringliteral">&#39;sld&#39;</span>   =&gt; $sld,</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="stringliteral">&#39;tld&#39;</span>   =&gt; $tld,</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        ), wp_get_referer() ) );</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keywordflow">return</span> $this-&gt;_call_paypal_api( <span class="stringliteral">&#39;SetExpressCheckout&#39;</span>, array(</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_AMT&#39;</span>           =&gt; $amount,</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_ITEMAMT&#39;</span>       =&gt; $amount,</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_CURRENCYCODE&#39;</span>  =&gt; <span class="stringliteral">&#39;USD&#39;</span>,</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_DESC&#39;</span>          =&gt; __( <span class="stringliteral">&#39;Payment for 1 year usage of the domain name.&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> ),</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_PAYMENTACTION&#39;</span> =&gt; <span class="stringliteral">&#39;Sale&#39;</span>,</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="stringliteral">&#39;L_PAYMENTREQUEST_0_NAME0&#39;</span>       =&gt; <span class="stringliteral">&quot;{$sld}.{$tld}&quot;</span>,</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="stringliteral">&#39;L_PAYMENTREQUEST_0_QTY0&#39;</span>        =&gt; 1,</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="stringliteral">&#39;L_PAYMENTREQUEST_0_AMT0&#39;</span>        =&gt; $amount,</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="stringliteral">&#39;LOCALECODE&#39;</span>                     =&gt; $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_site&#39;</span> ),</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="stringliteral">&#39;NOSHIPPING&#39;</span>                     =&gt; 1,</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <span class="stringliteral">&#39;ALLOWNOTE&#39;</span>                      =&gt; 0,</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="stringliteral">&#39;RETURNURL&#39;</span>                      =&gt; $returnurl,</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            <span class="stringliteral">&#39;CANCELURL&#39;</span>                      =&gt; site_url( <span class="stringliteral">&quot;{$cancelurl[&#39;path&#39;]}?{$cancelurl[&#39;query&#39;]}&quot;</span> ),</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            <span class="stringliteral">&#39;HDRIMG&#39;</span>                         =&gt; $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_header_img&#39;</span> ),</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            <span class="stringliteral">&#39;HDRBORDERCOLOR&#39;</span>                 =&gt; $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_header_border&#39;</span> ),</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="stringliteral">&#39;HDRBACKCOLOR&#39;</span>                   =&gt; $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_header_back&#39;</span> ),</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="stringliteral">&#39;PAYFLOWCOLOR&#39;</span>                   =&gt; $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_page_back&#39;</span> ),</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        ) );</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    }</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _call_paypal_api( $method, array $args ) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        global $psts;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">if</span> ( !$psts ) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        $endpoint = $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_status&#39;</span> ) == <span class="stringliteral">&#39;live&#39;</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            ? <span class="stringliteral">&quot;https://api-3t.paypal.com/nvp&quot;</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            : <span class="stringliteral">&quot;https://api-3t.sandbox.paypal.com/nvp&quot;</span>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        $response = wp_remote_post( $endpoint, array(</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="stringliteral">&#39;user-agent&#39;</span> =&gt; <span class="stringliteral">&quot;Pro Sites: http://premium.wpmudev.org/project/pro-sites | PayPal Express/Pro Gateway&quot;</span>,</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="stringliteral">&#39;sslverify&#39;</span>  =&gt; <span class="keyword">false</span>,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="stringliteral">&#39;timeout&#39;</span>    =&gt; 60,</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <span class="stringliteral">&#39;body&#39;</span>       =&gt; http_build_query( array_merge( array(</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                <span class="stringliteral">&#39;VERSION&#39;</span>   =&gt; <span class="stringliteral">&#39;63.0&#39;</span>,</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                <span class="stringliteral">&#39;PWD&#39;</span>       =&gt; $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_api_pass&#39;</span> ),</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                <span class="stringliteral">&#39;USER&#39;</span>      =&gt; $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_api_user&#39;</span> ),</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                <span class="stringliteral">&#39;SIGNATURE&#39;</span> =&gt; $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_api_sig&#39;</span> ),</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                <span class="stringliteral">&#39;METHOD&#39;</span>    =&gt; $method,</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            ), $args ) ),</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        ) );</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="keywordflow">if</span> ( is_wp_error( $response ) || wp_remote_retrieve_response_code( $response ) != 200 ) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        $nvp_response = array();</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        parse_str( wp_remote_retrieve_body( $response ), $nvp_response );</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordflow">return</span> $nvp_response;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00799"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a87ac0d19b28ba22ae993283e7ee11be0">  799</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#a87ac0d19b28ba22ae993283e7ee11be0">proceed_paypal_checkout</a>() {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        global $psts;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        $tld = strtolower( trim( filter_input( INPUT_GET, <span class="stringliteral">&#39;tld&#39;</span> ) ) );</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        $sld = strtolower( trim( filter_input( INPUT_GET, <span class="stringliteral">&#39;sld&#39;</span> ) ) );</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        $response = $this-&gt;_set_express_checkout( $this-&gt;<a class="code" href="class_domainmap___reseller.html#ab75e4def898a80008c79720e1d271f37">get_tld_price</a>( $tld ), $sld, $tld );</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">if</span> ( !$response || !isset( $response[<span class="stringliteral">&#39;ACK&#39;</span>] ) || !isset( $response[<span class="stringliteral">&#39;TOKEN&#39;</span>] ) || ( $response[<span class="stringliteral">&#39;ACK&#39;</span>] != <span class="stringliteral">&#39;Success&#39;</span> &amp;&amp; $response[<span class="stringliteral">&#39;ACK&#39;</span>] != <span class="stringliteral">&#39;SuccessWithWarning&#39;</span> ) ) {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        $paypal_url = $psts-&gt;get_setting( <span class="stringliteral">&#39;pypl_status&#39;</span> ) == <span class="stringliteral">&#39;live&#39;</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            ? <span class="stringliteral">&quot;https://www.paypal.com/cgi-bin/webscr?cmd=_express-checkout&amp;token=&quot;</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            : <span class="stringliteral">&quot;https://www.sandbox.paypal.com/webscr?cmd=_express-checkout&amp;token=&quot;</span>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        wp_redirect( $paypal_url . urlencode( $response[<span class="stringliteral">&#39;TOKEN&#39;</span>] ) );</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        exit;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#ab964e580c60e4407d963673632f9fc1b">  825</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#ab964e580c60e4407d963673632f9fc1b">complete_paypal_checkout</a>() {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        $token = filter_input( INPUT_GET, <span class="stringliteral">&#39;token&#39;</span> );</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <span class="keywordflow">if</span> ( !$token ) {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="comment">// receive checkout details</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        $details = $this-&gt;_call_paypal_api( <span class="stringliteral">&#39;GetExpressCheckoutDetails&#39;</span>, array( <span class="stringliteral">&#39;TOKEN&#39;</span> =&gt; $token ) );</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">if</span> ( !$details || !isset( $details[<span class="stringliteral">&#39;ACK&#39;</span>] ) || ( $details[<span class="stringliteral">&#39;ACK&#39;</span>] != <span class="stringliteral">&#39;Success&#39;</span> &amp;&amp; $details[<span class="stringliteral">&#39;ACK&#39;</span>] != <span class="stringliteral">&#39;SuccessWithWarning&#39;</span> ) ) {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="comment">// complete checkout</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        $response = $this-&gt;_call_paypal_api( <span class="stringliteral">&#39;DoExpressCheckoutPayment&#39;</span>, array(</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <span class="stringliteral">&#39;PAYERID&#39;</span>                        =&gt; $details[<span class="stringliteral">&#39;PAYERID&#39;</span>],</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <span class="stringliteral">&#39;TOKEN&#39;</span>                          =&gt; $details[<span class="stringliteral">&#39;TOKEN&#39;</span>],</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_PAYMENTACTION&#39;</span> =&gt; <span class="stringliteral">&#39;Sale&#39;</span>,</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_CURRENCYCODE&#39;</span>  =&gt; $details[<span class="stringliteral">&#39;PAYMENTREQUEST_0_CURRENCYCODE&#39;</span>],</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_AMT&#39;</span>           =&gt; $details[<span class="stringliteral">&#39;PAYMENTREQUEST_0_AMT&#39;</span>],</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="stringliteral">&#39;PAYMENTREQUEST_0_ITEMAMT&#39;</span>       =&gt; $details[<span class="stringliteral">&#39;PAYMENTREQUEST_0_ITEMAMT&#39;</span>],</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="stringliteral">&#39;L_PAYMENTREQUEST_0_QTY0&#39;</span>        =&gt; $details[<span class="stringliteral">&#39;L_PAYMENTREQUEST_0_QTY0&#39;</span>],</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="stringliteral">&#39;L_PAYMENTREQUEST_0_AMT0&#39;</span>        =&gt; $details[<span class="stringliteral">&#39;L_PAYMENTREQUEST_0_AMT0&#39;</span>],</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <span class="stringliteral">&#39;L_PAYMENTREQUEST_0_NAME0&#39;</span>       =&gt; $details[<span class="stringliteral">&#39;L_PAYMENTREQUEST_0_NAME0&#39;</span>],</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <span class="stringliteral">&#39;L_PAYMENTREQUEST_0_NUMBER0&#39;</span>     =&gt; 0,</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        ) );</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="keywordflow">if</span> ( !$response || !isset( $response[<span class="stringliteral">&#39;ACK&#39;</span>] ) || ( $response[<span class="stringliteral">&#39;ACK&#39;</span>] != <span class="stringliteral">&#39;Success&#39;</span> &amp;&amp; $response[<span class="stringliteral">&#39;ACK&#39;</span>] != <span class="stringliteral">&#39;SuccessWithWarning&#39;</span> ) ) {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        $sld = trim( filter_input( INPUT_GET, <span class="stringliteral">&#39;sld&#39;</span> ) );</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        $tld = trim( filter_input( INPUT_GET, <span class="stringliteral">&#39;tld&#39;</span> ) );</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        $response = $this-&gt;_exec_command( self::COMMAND_PURCHASE, array(</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="stringliteral">&#39;sld&#39;</span>           =&gt; $sld,</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <span class="stringliteral">&#39;tld&#39;</span>           =&gt; $tld,</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            <span class="stringliteral">&#39;UseDNS&#39;</span>        =&gt; <span class="stringliteral">&#39;default&#39;</span>,</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <span class="stringliteral">&#39;UseCreditCard&#39;</span> =&gt; <span class="stringliteral">&#39;no&#39;</span>,</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="stringliteral">&#39;EndUserIP&#39;</span>     =&gt; $_SERVER[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>],</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        ) );</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        $this-&gt;_log_enom_request( self::REQUEST_PURCHASE_DOMAIN, $response );</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="keywordflow">if</span> ( $response &amp;&amp; isset( $response-&gt;RRPCode ) &amp;&amp; $response-&gt;RRPCode == 200 ) {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            $this-&gt;_populate_dns_records( $tld, $sld );</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;{$sld}.{$tld}&quot;</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    }</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a0fcf5c99f4211cac9817e71dce3671b6">  884</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#a0fcf5c99f4211cac9817e71dce3671b6">support_account_registration</a>() {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a42a4eb344f169ca80249899fa2846d8d">  896</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#a42a4eb344f169ca80249899fa2846d8d">render_registration_form</a>() {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        global $current_user;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        get_currentuserinfo();</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        $cardholder = trim( $current_user-&gt;user_firstname . <span class="charliteral">&#39; &#39;</span> . $current_user-&gt;user_lastname );</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keywordflow">if</span> ( empty( $cardholder ) ) {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            $cardholder = __( <span class="stringliteral">&#39;Your name&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> );</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        $template = <span class="keyword">new</span> <a class="code" href="class_domainmap___render___reseller___enom___register.html">Domainmap_Render_Reseller_Enom_Register</a>();</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        $template-&gt;errors = $this-&gt;<a class="code" href="class_domainmap___reseller.html#a675e17edda17e5a7b4bfb6fc16247f7f">get_last_errors</a>();</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        $template-&gt;cardtypes = $this-&gt;<a class="code" href="class_domainmap___reseller.html#a9f67f9904a81a692e3cd145b40b282ce">get_card_types</a>();</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        $template-&gt;cardholder = $cardholder;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        $template-&gt;countries = <a class="code" href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin::instance</a>()-&gt;get_countries();</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        $template-&gt;render();</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno"><a class="line" href="class_domainmap___reseller___enom.html#a19ff95ed065f8ca18b6aac5f008f12b5">  923</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___reseller___enom.html#a19ff95ed065f8ca18b6aac5f008f12b5">regiser_account</a>() {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        $force_production = !defined( <span class="stringliteral">&#39;DOMAINMAPPING_FORCE_PRODUCTION&#39;</span> ) || filter_var( DOMAINMAPPING_FORCE_PRODUCTION, FILTER_VALIDATE_BOOLEAN );</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        $registrant_phone = <span class="charliteral">&#39;+&#39;</span> . preg_replace( <span class="stringliteral">&#39;/[^0-9\.]/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_phone&#39;</span> ) );</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        $registrant_fax = <span class="charliteral">&#39;+&#39;</span> . preg_replace( <span class="stringliteral">&#39;/[^0-9\.]/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_fax&#39;</span> ) );</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        $response = $this-&gt;_exec_command( self::COMMAND_REGISTER_ACCOUNT, array(</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="stringliteral">&#39;uid&#39;</span>                            =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="stringliteral">&#39;pw&#39;</span>                             =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <span class="comment">// account information</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="stringliteral">&#39;NewUID&#39;</span>                         =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;account_login&#39;</span> ),</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            <span class="stringliteral">&#39;NewPW&#39;</span>                          =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;account_password&#39;</span> ),</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="stringliteral">&#39;ConfirmPW&#39;</span>                      =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;account_password_confirm&#39;</span> ),</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            <span class="stringliteral">&#39;RegistrantEmailAddress_Contact&#39;</span> =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;account_email&#39;</span> ),</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            <span class="stringliteral">&#39;AuthQuestionType&#39;</span>               =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;account_question_type&#39;</span> ),</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="stringliteral">&#39;AuthQuestionAnswer&#39;</span>             =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;account_question_answer&#39;</span> ),</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            <span class="stringliteral">&#39;Reseller&#39;</span>                       =&gt; 1,</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <span class="stringliteral">&#39;EndUserIP&#39;</span>                      =&gt; self::_get_remote_ip(),</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            <span class="comment">// registrant information</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <span class="stringliteral">&#39;RegistrantFirstName&#39;</span>            =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_first_name&#39;</span> ),</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="stringliteral">&#39;RegistrantLastName&#39;</span>             =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_last_name&#39;</span> ),</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="stringliteral">&#39;RegistrantOrganizationName&#39;</span>     =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_organization&#39;</span> ),</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            <span class="stringliteral">&#39;RegistrantJobTitle&#39;</span>             =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_job_title&#39;</span> ),</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="stringliteral">&#39;RegistrantAddress1&#39;</span>             =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_address1&#39;</span> ),</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="stringliteral">&#39;RegistrantAddress2&#39;</span>             =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_address2&#39;</span> ),</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            <span class="stringliteral">&#39;RegistrantCity&#39;</span>                 =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_city&#39;</span> ),</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="stringliteral">&#39;RegistrantStateProvince&#39;</span>        =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_state&#39;</span> ),</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="stringliteral">&#39;RegistrantPostalCode&#39;</span>           =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_zip&#39;</span> ),</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="stringliteral">&#39;RegistrantCountry&#39;</span>              =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_country&#39;</span> ),</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            <span class="stringliteral">&#39;RegistrantEmailAddress&#39;</span>         =&gt; filter_input( INPUT_POST, <span class="stringliteral">&#39;registrant_email&#39;</span> ),</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <span class="stringliteral">&#39;RegistrantPhone&#39;</span>                =&gt; $registrant_phone,</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            <span class="stringliteral">&#39;RegistrantFax&#39;</span>                  =&gt; $registrant_fax,</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            <span class="comment">// proxy stuff</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <span class="stringliteral">&#39;LiveEnvironment&#39;</span>                =&gt; $force_production ? 1 : 0,</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            <span class="stringliteral">&#39;UserAgent&#39;</span>                      =&gt; isset( $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>] ) ? $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        ), self::ENDPOINT_PROXY );</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <span class="comment">// check if we received invalid xml and was not able to parse it</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">if</span> ( !$response ) {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            $response = <span class="keyword">new</span> WP_Error();</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            $response-&gt;add( <span class="stringliteral">&#39;invalid_xml&#39;</span>, __( <span class="stringliteral">&#39;We received unexpected result from eNom server. Try to resubmit your form again and if you receive information that such login is already exists, then it means that current request was processed successfully.&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> ) );</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <span class="comment">// pass FALSE as request type to process errors only</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        $this-&gt;_log_enom_request( <span class="keyword">false</span>, $response );</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">return</span> $response &amp;&amp; isset( $response-&gt;ErrCount ) &amp;&amp; $response-&gt;ErrCount == 0;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;}</div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a85e894618e7beaa3d8eae1a30746d6a6"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a85e894618e7beaa3d8eae1a30746d6a6">Domainmap_Reseller_Enom\ENVIRONMENT_PRODUCTION</a></div><div class="ttdeci">const ENVIRONMENT_PRODUCTION</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00038">Enom.php:38</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a0fcf5c99f4211cac9817e71dce3671b6"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a0fcf5c99f4211cac9817e71dce3671b6">Domainmap_Reseller_Enom\support_account_registration</a></div><div class="ttdeci">support_account_registration()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00884">Enom.php:884</a></div></div>
<div class="ttc" id="class_domainmap___reseller_html"><div class="ttname"><a href="class_domainmap___reseller.html">Domainmap_Reseller</a></div><div class="ttdef"><b>Definition:</b> <a href="_reseller_8php_source.html#l00031">Reseller.php:31</a></div></div>
<div class="ttc" id="class_domainmap___render___reseller___enom___purchase_html"><div class="ttname"><a href="class_domainmap___render___reseller___enom___purchase.html">Domainmap_Render_Reseller_Enom_Purchase</a></div><div class="ttdef"><b>Definition:</b> <a href="_render_2_reseller_2_enom_2_purchase_8php_source.html#l00030">Purchase.php:30</a></div></div>
<div class="ttc" id="class_domainmap___plugin_html_af6f2cc6311e8c59144fd2a21f0a186c5"><div class="ttname"><a href="class_domainmap___plugin.html#af6f2cc6311e8c59144fd2a21f0a186c5">Domainmap_Plugin\ACTION_PAYPAL_DO_EXPRESS_CHECKOUT</a></div><div class="ttdeci">const ACTION_PAYPAL_DO_EXPRESS_CHECKOUT</div><div class="ttdef"><b>Definition:</b> <a href="_plugin_8php_source.html#l00038">Plugin.php:38</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_aac4e1a507ab6024d478dfdedbf1924f2"><div class="ttname"><a href="class_domainmap___reseller___enom.html#aac4e1a507ab6024d478dfdedbf1924f2">Domainmap_Reseller_Enom\COMMAND_GET_TLD_LIST</a></div><div class="ttdeci">const COMMAND_GET_TLD_LIST</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00043">Enom.php:43</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a8304c6c09176f9b996cb8312612187b6"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a8304c6c09176f9b996cb8312612187b6">Domainmap_Reseller_Enom\ENVIRONMENT_TEST</a></div><div class="ttdeci">const ENVIRONMENT_TEST</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00039">Enom.php:39</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a1632cb752cdaa83181fe5341de96f422"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a1632cb752cdaa83181fe5341de96f422">Domainmap_Reseller_Enom\purchase</a></div><div class="ttdeci">purchase()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00443">Enom.php:443</a></div></div>
<div class="ttc" id="class_domainmap___render___reseller___enom___register_html"><div class="ttname"><a href="class_domainmap___render___reseller___enom___register.html">Domainmap_Render_Reseller_Enom_Register</a></div><div class="ttdef"><b>Definition:</b> <a href="_render_2_reseller_2_enom_2_register_8php_source.html#l00030">Register.php:30</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a99a2e93fb647b699371cb19e2d28915b"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a99a2e93fb647b699371cb19e2d28915b">Domainmap_Reseller_Enom\is_valid</a></div><div class="ttdeci">is_valid()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00361">Enom.php:361</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a87ac0d19b28ba22ae993283e7ee11be0"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a87ac0d19b28ba22ae993283e7ee11be0">Domainmap_Reseller_Enom\proceed_paypal_checkout</a></div><div class="ttdeci">proceed_paypal_checkout()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00799">Enom.php:799</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a449a3aa26a4613349987d1fb390ca040"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a449a3aa26a4613349987d1fb390ca040">Domainmap_Reseller_Enom\COMMAND_CHECK_LOGIN</a></div><div class="ttdeci">const COMMAND_CHECK_LOGIN</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00041">Enom.php:41</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_ad0a7aed24a1a1d3be1f463feb191f46f"><div class="ttname"><a href="class_domainmap___reseller___enom.html#ad0a7aed24a1a1d3be1f463feb191f46f">Domainmap_Reseller_Enom\save_options</a></div><div class="ttdeci">save_options(&amp;$options)</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00159">Enom.php:159</a></div></div>
<div class="ttc" id="class_domainmap___plugin_html_a0c4e33c65e6c007606223ad5211f7e91"><div class="ttname"><a href="class_domainmap___plugin.html#a0c4e33c65e6c007606223ad5211f7e91">Domainmap_Plugin\ACTION_SHOW_REGISTRATION_FORM</a></div><div class="ttdeci">const ACTION_SHOW_REGISTRATION_FORM</div><div class="ttdef"><b>Definition:</b> <a href="_plugin_8php_source.html#l00036">Plugin.php:36</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a450dd6b6bcd430855be105cfa310f23b"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a450dd6b6bcd430855be105cfa310f23b">Domainmap_Reseller_Enom\ENDPOINT_PRODUCTION</a></div><div class="ttdeci">const ENDPOINT_PRODUCTION</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00034">Enom.php:34</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a233cda1feaa3a3ba0520001dada54cc0"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a233cda1feaa3a3ba0520001dada54cc0">Domainmap_Reseller_Enom\COMMAND_CHECK</a></div><div class="ttdeci">const COMMAND_CHECK</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00042">Enom.php:42</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_ac01f0421cdf853d8bdac45fcd181dc28"><div class="ttname"><a href="class_domainmap___reseller___enom.html#ac01f0421cdf853d8bdac45fcd181dc28">Domainmap_Reseller_Enom\get_title</a></div><div class="ttdeci">get_title()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00321">Enom.php:321</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a78f5f806a4437d5af738fb00ce81d493"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a78f5f806a4437d5af738fb00ce81d493">Domainmap_Reseller_Enom\GATEWAY_PROSITES</a></div><div class="ttdeci">const GATEWAY_PROSITES</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00051">Enom.php:51</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a8c9cb5020d8eaa0db4927b77a1d65127"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a8c9cb5020d8eaa0db4927b77a1d65127">Domainmap_Reseller_Enom\COMMAND_SET_HOSTS</a></div><div class="ttdeci">const COMMAND_SET_HOSTS</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00046">Enom.php:46</a></div></div>
<div class="ttc" id="sunrise_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="sunrise_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdef"><b>Definition:</b> <a href="sunrise_8php_source.html#l00005">sunrise.php:5</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a33cf6da9af003c5c5707d75614d6b22d"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a33cf6da9af003c5c5707d75614d6b22d">Domainmap_Reseller_Enom\get_domain_available_response</a></div><div class="ttdeci">get_domain_available_response($sld, $tld, $purchase_link=false)</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00658">Enom.php:658</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a92c4451df2f2646c9402f158c142f073"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a92c4451df2f2646c9402f158c142f073">Domainmap_Reseller_Enom\ENDPOINT_PROXY</a></div><div class="ttdeci">const ENDPOINT_PROXY</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00036">Enom.php:36</a></div></div>
<div class="ttc" id="class_domainmap___reseller_html_a8e39ae31a98607442483e508edd072f4"><div class="ttname"><a href="class_domainmap___reseller.html#a8e39ae31a98607442483e508edd072f4">Domainmap_Reseller\_log_request</a></div><div class="ttdeci">_log_request($type, $valid, $errors, $response)</div><div class="ttdef"><b>Definition:</b> <a href="_reseller_8php_source.html#l00281">Reseller.php:281</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_ad66b4ad776c342e9b491e68ba7d1867b"><div class="ttname"><a href="class_domainmap___reseller___enom.html#ad66b4ad776c342e9b491e68ba7d1867b">Domainmap_Reseller_Enom\get_reseller_id</a></div><div class="ttdeci">get_reseller_id()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00060">Enom.php:60</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a82039a37711a6e0c9d2ccdae6ce15a48"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a82039a37711a6e0c9d2ccdae6ce15a48">Domainmap_Reseller_Enom\ENDPOINT_TEST</a></div><div class="ttdeci">const ENDPOINT_TEST</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00035">Enom.php:35</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html"><div class="ttname"><a href="class_domainmap___reseller___enom.html">Domainmap_Reseller_Enom</a></div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00030">Enom.php:30</a></div></div>
<div class="ttc" id="class_domainmap___plugin_html_a2aa8435615e980dfaf2c95a8b9c0375f"><div class="ttname"><a href="class_domainmap___plugin.html#a2aa8435615e980dfaf2c95a8b9c0375f">Domainmap_Plugin\ACTION_HEARTBEAT_CHECK</a></div><div class="ttdeci">const ACTION_HEARTBEAT_CHECK</div><div class="ttdef"><b>Definition:</b> <a href="_plugin_8php_source.html#l00046">Plugin.php:46</a></div></div>
<div class="ttc" id="class_domainmap___render___reseller___enom___settings_html"><div class="ttname"><a href="class_domainmap___render___reseller___enom___settings.html">Domainmap_Render_Reseller_Enom_Settings</a></div><div class="ttdef"><b>Definition:</b> <a href="_enom_2_settings_8php_source.html#l00031">Settings.php:31</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_add93e09651b78e81b6efc3c38b079452"><div class="ttname"><a href="class_domainmap___reseller___enom.html#add93e09651b78e81b6efc3c38b079452">Domainmap_Reseller_Enom\render_options</a></div><div class="ttdeci">render_options()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00332">Enom.php:332</a></div></div>
<div class="ttc" id="class_domainmap___plugin_html_a0deb004950b8dc4f51836316fd19c111"><div class="ttname"><a href="class_domainmap___plugin.html#a0deb004950b8dc4f51836316fd19c111">Domainmap_Plugin\instance</a></div><div class="ttdeci">static instance()</div><div class="ttdef"><b>Definition:</b> <a href="_plugin_8php_source.html#l00131">Plugin.php:131</a></div></div>
<div class="ttc" id="class_domainmap___reseller_html_a9f67f9904a81a692e3cd145b40b282ce"><div class="ttname"><a href="class_domainmap___reseller.html#a9f67f9904a81a692e3cd145b40b282ce">Domainmap_Reseller\get_card_types</a></div><div class="ttdeci">get_card_types()</div><div class="ttdef"><b>Definition:</b> <a href="_reseller_8php_source.html#l00250">Reseller.php:250</a></div></div>
<div class="ttc" id="class_domainmap___plugin_html_ab093deb6caacb21da50b2a854d9da98e"><div class="ttname"><a href="class_domainmap___plugin.html#ab093deb6caacb21da50b2a854d9da98e">Domainmap_Plugin\ACTION_PAYPAL_PURCHASE</a></div><div class="ttdeci">const ACTION_PAYPAL_PURCHASE</div><div class="ttdef"><b>Definition:</b> <a href="_plugin_8php_source.html#l00039">Plugin.php:39</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_ac47d461c9dbf0016d01fb5ed014f5856"><div class="ttname"><a href="class_domainmap___reseller___enom.html#ac47d461c9dbf0016d01fb5ed014f5856">Domainmap_Reseller_Enom\_check_domain</a></div><div class="ttdeci">_check_domain($tld, $sld)</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00399">Enom.php:399</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_aca7c0095ca2291aceadb87c846cd1600"><div class="ttname"><a href="class_domainmap___reseller___enom.html#aca7c0095ca2291aceadb87c846cd1600">Domainmap_Reseller_Enom\_get_tld_price</a></div><div class="ttdeci">_get_tld_price($tld, $period)</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00420">Enom.php:420</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_aa601dc907edd97e9f80b1554b6d46ea0"><div class="ttname"><a href="class_domainmap___reseller___enom.html#aa601dc907edd97e9f80b1554b6d46ea0">Domainmap_Reseller_Enom\_get_tld_list</a></div><div class="ttdeci">_get_tld_list()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00374">Enom.php:374</a></div></div>
<div class="ttc" id="class_domainmap___reseller_html_ab75e4def898a80008c79720e1d271f37"><div class="ttname"><a href="class_domainmap___reseller.html#ab75e4def898a80008c79720e1d271f37">Domainmap_Reseller\get_tld_price</a></div><div class="ttdeci">get_tld_price($tld, $period=1)</div><div class="ttdef"><b>Definition:</b> <a href="_reseller_8php_source.html#l00228">Reseller.php:228</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a438e9cc8f314cc4475020198db90947c"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a438e9cc8f314cc4475020198db90947c">Domainmap_Reseller_Enom\render_purchase_form</a></div><div class="ttdeci">render_purchase_form($domain_info)</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00593">Enom.php:593</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_ac66c64ce90007f2a45883ac1dd547c6b"><div class="ttname"><a href="class_domainmap___reseller___enom.html#ac66c64ce90007f2a45883ac1dd547c6b">Domainmap_Reseller_Enom\COMMAND_RETAIL_PRICE</a></div><div class="ttdeci">const COMMAND_RETAIL_PRICE</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00044">Enom.php:44</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_add5dc69ffd7a875d957270d68f4dc85d"><div class="ttname"><a href="class_domainmap___reseller___enom.html#add5dc69ffd7a875d957270d68f4dc85d">Domainmap_Reseller_Enom\COMMAND_GET_EXT_ATTRIBUTES</a></div><div class="ttdeci">const COMMAND_GET_EXT_ATTRIBUTES</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00047">Enom.php:47</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a42a4eb344f169ca80249899fa2846d8d"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a42a4eb344f169ca80249899fa2846d8d">Domainmap_Reseller_Enom\render_registration_form</a></div><div class="ttdeci">render_registration_form()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00896">Enom.php:896</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_ab964e580c60e4407d963673632f9fc1b"><div class="ttname"><a href="class_domainmap___reseller___enom.html#ab964e580c60e4407d963673632f9fc1b">Domainmap_Reseller_Enom\complete_paypal_checkout</a></div><div class="ttdeci">complete_paypal_checkout()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00825">Enom.php:825</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_ae801d329add65a635dfe3662adbb6e96"><div class="ttname"><a href="class_domainmap___reseller___enom.html#ae801d329add65a635dfe3662adbb6e96">Domainmap_Reseller_Enom\COMMAND_REGISTER_ACCOUNT</a></div><div class="ttdeci">const COMMAND_REGISTER_ACCOUNT</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00048">Enom.php:48</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a19ff95ed065f8ca18b6aac5f008f12b5"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a19ff95ed065f8ca18b6aac5f008f12b5">Domainmap_Reseller_Enom\regiser_account</a></div><div class="ttdeci">regiser_account()</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00923">Enom.php:923</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a068df92d9e337b6c4784bbacaed60504"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a068df92d9e337b6c4784bbacaed60504">Domainmap_Reseller_Enom\GATEWAY_ENOM</a></div><div class="ttdeci">const GATEWAY_ENOM</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00050">Enom.php:50</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_afeb28537012175f202d750fb8b658e56"><div class="ttname"><a href="class_domainmap___reseller___enom.html#afeb28537012175f202d750fb8b658e56">Domainmap_Reseller_Enom\COMMAND_PURCHASE</a></div><div class="ttdeci">const COMMAND_PURCHASE</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00045">Enom.php:45</a></div></div>
<div class="ttc" id="class_domainmap___reseller_html_a675e17edda17e5a7b4bfb6fc16247f7f"><div class="ttname"><a href="class_domainmap___reseller.html#a675e17edda17e5a7b4bfb6fc16247f7f">Domainmap_Reseller\get_last_errors</a></div><div class="ttdeci">get_last_errors()</div><div class="ttdef"><b>Definition:</b> <a href="_reseller_8php_source.html#l00079">Reseller.php:79</a></div></div>
<div class="ttc" id="class_domainmap___reseller___enom_html_a6d9d81b65364da06588e5a7aa028eb92"><div class="ttname"><a href="class_domainmap___reseller___enom.html#a6d9d81b65364da06588e5a7aa028eb92">Domainmap_Reseller_Enom\RESELLER_ID</a></div><div class="ttdeci">const RESELLER_ID</div><div class="ttdef"><b>Definition:</b> <a href="_enom_8php_source.html#l00032">Enom.php:32</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_0560c4a4c6149ff4802773baa71c0d22.html">OneDrive</a></li><li class="navelem"><a class="el" href="dir_2118a8f33e94722cef96827f3801fee3.html">wpms.network</a></li><li class="navelem"><a class="el" href="dir_8943648afa701a01942f58e6b8f8f698.html">CurrentSetup</a></li><li class="navelem"><a class="el" href="dir_f802b33df1f3bf73960f7b6a01d62693.html">wp-content</a></li><li class="navelem"><a class="el" href="dir_d458f8ab865d077adc9c10df3001dda7.html">plugins</a></li><li class="navelem"><a class="el" href="dir_843128821777c4d026ade0567c7bff1d.html">domain-mapping</a></li><li class="navelem"><a class="el" href="dir_16146d95df0c9964b7e228d6e9003139.html">classes</a></li><li class="navelem"><a class="el" href="dir_4522f486459d1765a14585148fe27356.html">Domainmap</a></li><li class="navelem"><a class="el" href="dir_6495c800e8be22542d00dd54b8d34eb6.html">Reseller</a></li><li class="navelem"><a class="el" href="_enom_8php.html">Enom.php</a></li>
    <li class="footer">Generated on Sun Mar 1 2015 15:16:46 for Domain Mapping 4.3.0.4 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
