<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Domain Mapping 4.3.0.4: C:/Users/Aaron/OneDrive/wpms.network/CurrentSetup/wp-content/plugins/domain-mapping/classes/Domainmap/Module/Cdsso.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Domain Mapping 4.3.0.4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_cdsso_8php_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Cdsso.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_cdsso_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// +----------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// | Copyright Incsub (http://incsub.com/)                                |</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// +----------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// | This program is free software; you can redistribute it and/or modify |</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// | it under the terms of the GNU General Public License, version 2, as  |</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// | published by the Free Software Foundation.                           |</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// |                                                                      |</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// | This program is distributed in the hope that it will be useful,      |</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// | but WITHOUT ANY WARRANTY; without even the implied warranty of       |</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        |</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// | GNU General Public License for more details.                         |</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// |                                                                      |</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// | You should have received a copy of the GNU General Public License    |</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// | along with this program; if not, write to the Free Software          |</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// | Foundation, Inc., 51 Franklin St, Fifth Floor, Boston,               |</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// | MA 02110-1301 USA                                                    |</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// +----------------------------------------------------------------------+</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html">   29</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_domainmap___module___cdsso.html">Domainmap_Module_Cdsso</a> <span class="keyword">extends</span> <a class="code" href="class_domainmap___module.html">Domainmap_Module</a> {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a244352f035b82b20b0efa506167fd862">   31</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___module___cdsso.html#a244352f035b82b20b0efa506167fd862">NAME</a> = __CLASS__;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a4769de315f80e2ff2c39aaf1ecd46d74">   33</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___module___cdsso.html#a4769de315f80e2ff2c39aaf1ecd46d74">ACTION_KEY</a> = <span class="stringliteral">&#39;__domainmap_action&#39;</span>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#ad8bbe5fc46c666f8bcb447811f857eab">   35</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___module___cdsso.html#ad8bbe5fc46c666f8bcb447811f857eab">ACTION_SETUP_CDSSO</a>    = <span class="stringliteral">&#39;domainmap-setup-cdsso&#39;</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a3f01a436eb9cbf60fd6c1caf015a103d">   36</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___module___cdsso.html#a3f01a436eb9cbf60fd6c1caf015a103d">ACTION_AUTHORIZE_USER</a> = <span class="stringliteral">&#39;domainmap-authorize-user&#39;</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a0db68d0f6aa6997b4b0502927cf32db8">   37</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___module___cdsso.html#a0db68d0f6aa6997b4b0502927cf32db8">ACTION_PROPAGATE_USER</a> = <span class="stringliteral">&#39;domainmap-propagate-user&#39;</span>;</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a48ed2983658823509122b78c7a659ea2">   38</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="class_domainmap___module___cdsso.html#a48ed2983658823509122b78c7a659ea2">ACTION_LOGOUT_USER</a>    = <span class="stringliteral">&#39;domainmap-logout-user&#39;</span>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keyword">private</span> $_do_propagation = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keyword">private</span> $_do_logout = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">private</span> $_load_in_footer = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">private</span> $_async = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a0832a26ad5405ac375ea2f0a1e2d41d4">   88</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#a0832a26ad5405ac375ea2f0a1e2d41d4">__construct</a>( <a class="code" href="class_domainmap___plugin.html">Domainmap_Plugin</a> $plugin ) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        parent::__construct( $plugin );</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        $this-&gt;_load_in_footer =  $plugin-&gt;<a class="code" href="class_domainmap___plugin.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c">get_option</a>(<span class="stringliteral">&quot;map_crossautologin_infooter&quot;</span>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        $this-&gt;_async =  $plugin-&gt;<a class="code" href="class_domainmap___plugin.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c">get_option</a>(<span class="stringliteral">&quot;map_crossautologin_async&quot;</span>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a809ad86e113a00f8a9e697597c2f8e68">_add_filter</a>( <span class="stringliteral">&#39;wp_redirect&#39;</span>, <span class="stringliteral">&#39;add_logout_marker&#39;</span> );</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a809ad86e113a00f8a9e697597c2f8e68">_add_filter</a>( <span class="stringliteral">&#39;login_redirect&#39;</span>, <span class="stringliteral">&#39;set_interim_login&#39;</span>, 10, 3 );</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a809ad86e113a00f8a9e697597c2f8e68">_add_filter</a>( <span class="stringliteral">&#39;login_message&#39;</span>, <span class="stringliteral">&#39;get_login_message&#39;</span> );</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a809ad86e113a00f8a9e697597c2f8e68">_add_filter</a>( <span class="stringliteral">&#39;login_url&#39;</span>, <span class="stringliteral">&#39;update_login_url&#39;</span>, 10, 2 );</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">_add_action</a>( $this-&gt;_load_in_footer ?  <span class="stringliteral">&#39;wp_footer&#39;</span> :  <span class="stringliteral">&#39;wp_head&#39;</span>, <span class="stringliteral">&#39;add_auth_script&#39;</span>, 0 );</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">_add_action</a>( <span class="stringliteral">&#39;login_form_login&#39;</span>, <span class="stringliteral">&#39;set_auth_script_for_login&#39;</span> );</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">_add_action</a>( <span class="stringliteral">&#39;wp_head&#39;</span>, <span class="stringliteral">&#39;add_logout_propagation_script&#39;</span>, 0 );</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">_add_action</a>( <span class="stringliteral">&#39;login_head&#39;</span>, <span class="stringliteral">&#39;add_logout_propagation_script&#39;</span>, 0 );</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">_add_action</a>( <span class="stringliteral">&#39;login_footer&#39;</span>, <span class="stringliteral">&#39;add_propagation_script&#39;</span> );</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">_add_action</a>( <span class="stringliteral">&#39;wp_logout&#39;</span>, <span class="stringliteral">&#39;set_logout_var&#39;</span> );</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">_add_action</a>( <span class="stringliteral">&#39;plugins_loaded&#39;</span>, <span class="stringliteral">&#39;authorize_user&#39;</span> );</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a9c4179e2887daa660a5c3631014246bc">_add_ajax_action</a>( self::ACTION_SETUP_CDSSO, <span class="stringliteral">&#39;setup_cdsso&#39;</span>, <span class="keyword">true</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a9c4179e2887daa660a5c3631014246bc">_add_ajax_action</a>( self::ACTION_PROPAGATE_USER, <span class="stringliteral">&#39;propagate_user&#39;</span>, <span class="keyword">true</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a9c4179e2887daa660a5c3631014246bc">_add_ajax_action</a>( self::ACTION_LOGOUT_USER, <span class="stringliteral">&#39;logout_user&#39;</span>, <span class="keyword">true</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#ab2698559929b7f6642e5f310b6cea05e">  124</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#ab2698559929b7f6642e5f310b6cea05e">set_auth_script_for_login</a>() {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        $this-&gt;<a class="code" href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">_add_action</a>( $this-&gt;_load_in_footer ? <span class="stringliteral">&quot;login_footer&quot;</span> : <span class="stringliteral">&#39;login_head&#39;</span>, <span class="stringliteral">&#39;add_auth_script&#39;</span>, 0 );</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#ae1a9eaed23445545400c64dfe451f9f9">  138</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#ae1a9eaed23445545400c64dfe451f9f9">update_login_url</a>( $login_url, $redirect_to ) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span>( empty( $redirect_to ) )</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="keywordflow">return</span> $login_url;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        $login_domain = parse_url( $login_url, PHP_URL_HOST );</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        $redirect_domain = parse_url( $redirect_to, PHP_URL_HOST );</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">if</span> ( $login_domain != $redirect_domain ) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            $redirect_to = str_replace( <span class="stringliteral">&quot;://{$redirect_domain}&quot;</span>, <span class="stringliteral">&quot;://{$login_domain}&quot;</span>, $redirect_to );</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            $login_url = add_query_arg( <span class="stringliteral">&#39;redirect_to&#39;</span>, urlencode( $redirect_to ), $login_url );</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">return</span> $login_url;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a90c8837da225fb78a12c5645e3eaf082">  160</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#a90c8837da225fb78a12c5645e3eaf082">set_logout_var</a>() {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        $this-&gt;_do_logout = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a8c6c1e43baeed39ce7c1a2810ca2d945">  174</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#a8c6c1e43baeed39ce7c1a2810ca2d945">add_logout_marker</a>( $redirect_to ) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">if</span> ( $this-&gt;_do_logout ) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            $redirect_to = add_query_arg( self::ACTION_KEY, self::ACTION_LOGOUT_USER, $redirect_to );</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">return</span> $redirect_to;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#af856b518d8c4f3d261633297b7c4d4ae">  191</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#af856b518d8c4f3d261633297b7c4d4ae">add_logout_propagation_script</a>() {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">if</span> ( is_user_logged_in() || get_current_blog_id() == 1 || filter_input( INPUT_GET, self::ACTION_KEY ) != self::ACTION_LOGOUT_USER ) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        $url = add_query_arg( <span class="stringliteral">&#39;action&#39;</span>, self::ACTION_LOGOUT_USER, $this-&gt;<a class="code" href="class_domainmap___module.html#ac6e69e0204c5c06d40472da862ece36b">get_main_ajax_url</a>() );</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        $this-&gt;_add_script( $url );</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#ac58cbd2a44e7a18fc82833c50f9e3caa">  209</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#ac58cbd2a44e7a18fc82833c50f9e3caa">logout_user</a>() {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        header( <span class="stringliteral">&quot;Content-Type: text/javascript; charset=&quot;</span> . get_bloginfo( <span class="stringliteral">&#39;charset&#39;</span> ) );</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">if</span> ( !is_user_logged_in() || empty( $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>] ) ) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            header( <span class="stringliteral">&quot;Vary: Accept-Encoding&quot;</span> ); <span class="comment">// Handle proxies</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            header( <span class="stringliteral">&quot;Expires: &quot;</span> . gmdate( <span class="stringliteral">&quot;D, d M Y H:i:s&quot;</span>, time() + MINUTE_IN_SECONDS ) . <span class="stringliteral">&quot; GMT&quot;</span> );</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            exit;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        wp_clear_auth_cookie();</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        $url = add_query_arg( self::ACTION_KEY, <span class="keyword">false</span>, $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>] );</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        echo <span class="stringliteral">&#39;window.location = &quot;&#39;</span>, $url, <span class="stringliteral">&#39;&quot;;&#39;</span>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        exit;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#afd1a49463814288ebc68bb88b9afae68">  238</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#afd1a49463814288ebc68bb88b9afae68">set_interim_login</a>( $redirect_to, $requested_redirect_to, $user ) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        global $interim_login;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">if</span> ( is_a( $user, <span class="stringliteral">&#39;WP_User&#39;</span> ) &amp;&amp; get_current_blog_id() != 1 ) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            $home = home_url( <span class="charliteral">&#39;/&#39;</span> );</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            $current_domain = parse_url( $home, PHP_URL_HOST );</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            $original_domain = parse_url( apply_filters( <span class="stringliteral">&#39;unswap_url&#39;</span>, $home ), PHP_URL_HOST );</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">if</span> ( $current_domain != $original_domain || $this-&gt;<a class="code" href="class_domainmap___module.html#a8ddcc9ac8c088c7cdcc7500a66628253">is_subdomain</a>() ) {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                $interim_login = $this-&gt;_do_propagation = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">return</span> $redirect_to;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a5310f9658354cdd03196f70afa8a6db1">  262</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#a5310f9658354cdd03196f70afa8a6db1">get_login_message</a>( $message ) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">return</span> $this-&gt;_do_propagation</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            ? <span class="stringliteral">&#39;&lt;p class=&quot;message&quot;&gt;&#39;</span> . esc_html__( <span class="stringliteral">&#39;You have logged in successfully. You will be redirected to desired page during next 5 seconds.&#39;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> ) . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            : $message;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#ad20cc99c7a3ccb9587f428f72a5bb544">  278</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#ad20cc99c7a3ccb9587f428f72a5bb544">add_propagation_script</a>() {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        global $redirect_to, $user;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">if</span> ( !$this-&gt;_do_propagation ) {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">if</span> ( ( empty( $redirect_to ) || $redirect_to == <span class="stringliteral">&#39;wp-admin/&#39;</span> || $redirect_to == admin_url() ) ) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="comment">// If the user doesn&#39;t belong to a blog, send them to user admin. If the user can&#39;t edit posts, send them to their profile.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">if</span> ( is_multisite() &amp;&amp; !get_active_blog_for_user( $user-&gt;ID ) &amp;&amp; !is_super_admin( $user-&gt;ID ) ) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                $redirect_to = user_admin_url();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            } elseif ( is_multisite() &amp;&amp; !$user-&gt;has_cap( <span class="stringliteral">&#39;read&#39;</span> ) ) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                $redirect_to = get_dashboard_url( $user-&gt;ID );</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            } elseif ( !$user-&gt;has_cap( <span class="stringliteral">&#39;edit_posts&#39;</span> ) ) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                $redirect_to = admin_url( <span class="stringliteral">&#39;profile.php&#39;</span> );</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        ?&gt;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        &lt;script &lt;?php echo $this-&gt;_async ? <span class="stringliteral">&quot;async=&#39;true&#39;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>; ?&gt;  type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keyword">function</span> domainmap_do_redirect() { window.location = <span class="stringliteral">&quot;&lt;?php echo $redirect_to ?&gt;&quot;</span>; }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            setTimeout(domainmap_do_redirect, 5000);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        &lt;/script&gt;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        &lt;?php</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        $url = add_query_arg( array(</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="stringliteral">&#39;action&#39;</span> =&gt; self::ACTION_PROPAGATE_USER,</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="stringliteral">&#39;auth&#39;</span>   =&gt; wp_generate_auth_cookie( $user-&gt;ID, time() + MINUTE_IN_SECONDS ),</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        ), $this-&gt;<a class="code" href="class_domainmap___module.html#ac6e69e0204c5c06d40472da862ece36b">get_main_ajax_url</a>() );</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        $this-&gt;_add_script( $url );</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#aa1316e287f77b2eae00f95f58b2b6b03">  321</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#aa1316e287f77b2eae00f95f58b2b6b03">add_auth_script</a>() {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">if</span> (   is_user_logged_in() ||  1  === get_current_blog_id() || filter_input( INPUT_GET, self::ACTION_KEY ) == self::ACTION_AUTHORIZE_USER ) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        $url = add_query_arg( <span class="stringliteral">&#39;action&#39;</span>, self::ACTION_SETUP_CDSSO, $this-&gt;<a class="code" href="class_domainmap___module.html#ac6e69e0204c5c06d40472da862ece36b">get_main_ajax_url</a>() );</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        $this-&gt;_add_script( $url );</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a3461e71401919dd21482781b150e6710">  339</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#a3461e71401919dd21482781b150e6710">setup_cdsso</a>() {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        header( <span class="stringliteral">&quot;Content-Type: text/javascript; charset=&quot;</span> . get_bloginfo( <span class="stringliteral">&#39;charset&#39;</span> ) );</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">if</span> ( !is_user_logged_in() || empty( $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>] ) ) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            header( <span class="stringliteral">&quot;Vary: Accept-Encoding&quot;</span> ); <span class="comment">// Handle proxies</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            header( <span class="stringliteral">&quot;Expires: &quot;</span> . gmdate( <span class="stringliteral">&quot;D, d M Y H:i:s&quot;</span>, time() + MINUTE_IN_SECONDS ) . <span class="stringliteral">&quot; GMT&quot;</span> );</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            exit;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        $url = add_query_arg( array(</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            self::ACTION_KEY =&gt; self::ACTION_AUTHORIZE_USER,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="stringliteral">&#39;auth&#39;</span>           =&gt; wp_generate_auth_cookie( get_current_user_id(), time() + MINUTE_IN_SECONDS ),</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        ), $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>] );</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        ?&gt;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        window.location.replace(<span class="stringliteral">&quot;&lt;?php echo $url ?&gt;&quot;</span>);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        &lt;?php</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        exit;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#a497457a99e73c07d3b88982d5bf51acd">  365</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#a497457a99e73c07d3b88982d5bf51acd">authorize_user</a>() {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">if</span> ( filter_input( INPUT_GET, self::ACTION_KEY ) == self::ACTION_AUTHORIZE_USER ) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;          $user_id = wp_validate_auth_cookie( filter_input( INPUT_GET, <span class="stringliteral">&#39;auth&#39;</span> ), <span class="stringliteral">&#39;auth&#39;</span> );</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="keywordflow">if</span> ( $user_id ) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                wp_set_auth_cookie( $user_id );</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                $redirect_to = in_array( $GLOBALS[<span class="stringliteral">&#39;pagenow&#39;</span>], array( <span class="stringliteral">&#39;wp-login.php&#39;</span> ) ) &amp;&amp; filter_input( INPUT_GET, <span class="stringliteral">&#39;redirect_to&#39;</span>, FILTER_VALIDATE_URL )</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    ? $_GET[<span class="stringliteral">&#39;redirect_to&#39;</span>]</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    : add_query_arg( array( self::ACTION_KEY =&gt; <span class="keyword">false</span>, <span class="stringliteral">&#39;auth&#39;</span> =&gt; <span class="keyword">false</span> ) );</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                wp_redirect( $redirect_to );</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                exit;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                wp_die( __( <span class="stringliteral">&quot;Incorrect or out of date login key&quot;</span>, <span class="stringliteral">&#39;domainmap&#39;</span> ) );</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="class_domainmap___module___cdsso.html#ac8877cfa5134e6d93a7baccc004ee701">  392</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="class_domainmap___module___cdsso.html#ac8877cfa5134e6d93a7baccc004ee701">propagate_user</a>() {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        header( <span class="stringliteral">&quot;Content-Type: text/javascript; charset=&quot;</span> . get_bloginfo( <span class="stringliteral">&#39;charset&#39;</span> ) );</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">if</span> ( get_current_blog_id() == 1 ) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            $user_id = wp_validate_auth_cookie( filter_input( INPUT_GET, <span class="stringliteral">&#39;auth&#39;</span> ), <span class="stringliteral">&#39;auth&#39;</span> );</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keywordflow">if</span> ( $user_id ) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                wp_set_auth_cookie( $user_id );</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                echo <span class="stringliteral">&#39;if (typeof domainmap_do_redirect === &quot;function&quot;) domainmap_do_redirect();&#39;</span>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                exit;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        exit;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keyword">private</span> <span class="keyword">function</span> _add_script( $url )</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">if</span>( $this-&gt;_async ):</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        ?&gt;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        &lt;script type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            (<span class="keyword">function</span>(d, t) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                var g = d.createElement(t),</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                    s = d.getElementsByTagName(t)[0];</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                g.src = <span class="stringliteral">&#39;&lt;?php echo $url ?&gt;&#39;</span>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                g.async = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                s.parentNode.insertBefore(g, s);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            }(document, <span class="stringliteral">&#39;script&#39;</span>));</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        &lt;/script&gt;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        &lt;?php</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        ?&gt;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            &lt;script type=<span class="stringliteral">&quot;text/javascript&quot;</span> src=<span class="stringliteral">&quot;&lt;?php echo $url; ?&gt;&quot;</span>&gt;&lt;/script&gt;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        &lt;?php</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        endif;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div>
<div class="ttc" id="class_domainmap___module_html_a2ab6f2b66e74d65003b85069b6e494d5"><div class="ttname"><a href="class_domainmap___module.html#a2ab6f2b66e74d65003b85069b6e494d5">Domainmap_Module\_add_action</a></div><div class="ttdeci">_add_action($tag, $method= '', $priority=10, $accepted_args=1)</div><div class="ttdef"><b>Definition:</b> <a href="_module_8php_source.html#l00092">Module.php:92</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_ac8877cfa5134e6d93a7baccc004ee701"><div class="ttname"><a href="class_domainmap___module___cdsso.html#ac8877cfa5134e6d93a7baccc004ee701">Domainmap_Module_Cdsso\propagate_user</a></div><div class="ttdeci">propagate_user()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00392">Cdsso.php:392</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a0db68d0f6aa6997b4b0502927cf32db8"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a0db68d0f6aa6997b4b0502927cf32db8">Domainmap_Module_Cdsso\ACTION_PROPAGATE_USER</a></div><div class="ttdeci">const ACTION_PROPAGATE_USER</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00037">Cdsso.php:37</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a497457a99e73c07d3b88982d5bf51acd"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a497457a99e73c07d3b88982d5bf51acd">Domainmap_Module_Cdsso\authorize_user</a></div><div class="ttdeci">authorize_user()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00365">Cdsso.php:365</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a3f01a436eb9cbf60fd6c1caf015a103d"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a3f01a436eb9cbf60fd6c1caf015a103d">Domainmap_Module_Cdsso\ACTION_AUTHORIZE_USER</a></div><div class="ttdeci">const ACTION_AUTHORIZE_USER</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00036">Cdsso.php:36</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_afd1a49463814288ebc68bb88b9afae68"><div class="ttname"><a href="class_domainmap___module___cdsso.html#afd1a49463814288ebc68bb88b9afae68">Domainmap_Module_Cdsso\set_interim_login</a></div><div class="ttdeci">set_interim_login($redirect_to, $requested_redirect_to, $user)</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00238">Cdsso.php:238</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_ad20cc99c7a3ccb9587f428f72a5bb544"><div class="ttname"><a href="class_domainmap___module___cdsso.html#ad20cc99c7a3ccb9587f428f72a5bb544">Domainmap_Module_Cdsso\add_propagation_script</a></div><div class="ttdeci">add_propagation_script()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00278">Cdsso.php:278</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a3461e71401919dd21482781b150e6710"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a3461e71401919dd21482781b150e6710">Domainmap_Module_Cdsso\setup_cdsso</a></div><div class="ttdeci">setup_cdsso()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00339">Cdsso.php:339</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_ae1a9eaed23445545400c64dfe451f9f9"><div class="ttname"><a href="class_domainmap___module___cdsso.html#ae1a9eaed23445545400c64dfe451f9f9">Domainmap_Module_Cdsso\update_login_url</a></div><div class="ttdeci">update_login_url($login_url, $redirect_to)</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00138">Cdsso.php:138</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_af856b518d8c4f3d261633297b7c4d4ae"><div class="ttname"><a href="class_domainmap___module___cdsso.html#af856b518d8c4f3d261633297b7c4d4ae">Domainmap_Module_Cdsso\add_logout_propagation_script</a></div><div class="ttdeci">add_logout_propagation_script()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00191">Cdsso.php:191</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a0832a26ad5405ac375ea2f0a1e2d41d4"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a0832a26ad5405ac375ea2f0a1e2d41d4">Domainmap_Module_Cdsso\__construct</a></div><div class="ttdeci">__construct(Domainmap_Plugin $plugin)</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00088">Cdsso.php:88</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a5310f9658354cdd03196f70afa8a6db1"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a5310f9658354cdd03196f70afa8a6db1">Domainmap_Module_Cdsso\get_login_message</a></div><div class="ttdeci">get_login_message($message)</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00262">Cdsso.php:262</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a90c8837da225fb78a12c5645e3eaf082"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a90c8837da225fb78a12c5645e3eaf082">Domainmap_Module_Cdsso\set_logout_var</a></div><div class="ttdeci">set_logout_var()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00160">Cdsso.php:160</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a48ed2983658823509122b78c7a659ea2"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a48ed2983658823509122b78c7a659ea2">Domainmap_Module_Cdsso\ACTION_LOGOUT_USER</a></div><div class="ttdeci">const ACTION_LOGOUT_USER</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00038">Cdsso.php:38</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_ad8bbe5fc46c666f8bcb447811f857eab"><div class="ttname"><a href="class_domainmap___module___cdsso.html#ad8bbe5fc46c666f8bcb447811f857eab">Domainmap_Module_Cdsso\ACTION_SETUP_CDSSO</a></div><div class="ttdeci">const ACTION_SETUP_CDSSO</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00035">Cdsso.php:35</a></div></div>
<div class="ttc" id="class_domainmap___plugin_html_a2d0e41bee9ffe5bbc8afa3e0b348ed2c"><div class="ttname"><a href="class_domainmap___plugin.html#a2d0e41bee9ffe5bbc8afa3e0b348ed2c">Domainmap_Plugin\get_option</a></div><div class="ttdeci">get_option($option, $default=false)</div><div class="ttdef"><b>Definition:</b> <a href="_plugin_8php_source.html#l00221">Plugin.php:221</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a244352f035b82b20b0efa506167fd862"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a244352f035b82b20b0efa506167fd862">Domainmap_Module_Cdsso\NAME</a></div><div class="ttdeci">const NAME</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00031">Cdsso.php:31</a></div></div>
<div class="ttc" id="class_domainmap___module_html"><div class="ttname"><a href="class_domainmap___module.html">Domainmap_Module</a></div><div class="ttdef"><b>Definition:</b> <a href="_module_8php_source.html#l00030">Module.php:30</a></div></div>
<div class="ttc" id="class_domainmap___module_html_a9c4179e2887daa660a5c3631014246bc"><div class="ttname"><a href="class_domainmap___module.html#a9c4179e2887daa660a5c3631014246bc">Domainmap_Module\_add_ajax_action</a></div><div class="ttdeci">_add_ajax_action($tag, $method= '', $private=true, $public=false)</div><div class="ttdef"><b>Definition:</b> <a href="_module_8php_source.html#l00109">Module.php:109</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_ab2698559929b7f6642e5f310b6cea05e"><div class="ttname"><a href="class_domainmap___module___cdsso.html#ab2698559929b7f6642e5f310b6cea05e">Domainmap_Module_Cdsso\set_auth_script_for_login</a></div><div class="ttdeci">set_auth_script_for_login()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00124">Cdsso.php:124</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_ac58cbd2a44e7a18fc82833c50f9e3caa"><div class="ttname"><a href="class_domainmap___module___cdsso.html#ac58cbd2a44e7a18fc82833c50f9e3caa">Domainmap_Module_Cdsso\logout_user</a></div><div class="ttdeci">logout_user()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00209">Cdsso.php:209</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_aa1316e287f77b2eae00f95f58b2b6b03"><div class="ttname"><a href="class_domainmap___module___cdsso.html#aa1316e287f77b2eae00f95f58b2b6b03">Domainmap_Module_Cdsso\add_auth_script</a></div><div class="ttdeci">add_auth_script()</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00321">Cdsso.php:321</a></div></div>
<div class="ttc" id="class_domainmap___module_html_a809ad86e113a00f8a9e697597c2f8e68"><div class="ttname"><a href="class_domainmap___module.html#a809ad86e113a00f8a9e697597c2f8e68">Domainmap_Module\_add_filter</a></div><div class="ttdeci">_add_filter($tag, $method= '', $priority=10, $accepted_args=1)</div><div class="ttdef"><b>Definition:</b> <a href="_module_8php_source.html#l00134">Module.php:134</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a8c6c1e43baeed39ce7c1a2810ca2d945"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a8c6c1e43baeed39ce7c1a2810ca2d945">Domainmap_Module_Cdsso\add_logout_marker</a></div><div class="ttdeci">add_logout_marker($redirect_to)</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00174">Cdsso.php:174</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html_a4769de315f80e2ff2c39aaf1ecd46d74"><div class="ttname"><a href="class_domainmap___module___cdsso.html#a4769de315f80e2ff2c39aaf1ecd46d74">Domainmap_Module_Cdsso\ACTION_KEY</a></div><div class="ttdeci">const ACTION_KEY</div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00033">Cdsso.php:33</a></div></div>
<div class="ttc" id="class_domainmap___module_html_a8ddcc9ac8c088c7cdcc7500a66628253"><div class="ttname"><a href="class_domainmap___module.html#a8ddcc9ac8c088c7cdcc7500a66628253">Domainmap_Module\is_subdomain</a></div><div class="ttdeci">is_subdomain()</div><div class="ttdef"><b>Definition:</b> <a href="_module_8php_source.html#l00264">Module.php:264</a></div></div>
<div class="ttc" id="class_domainmap___module___cdsso_html"><div class="ttname"><a href="class_domainmap___module___cdsso.html">Domainmap_Module_Cdsso</a></div><div class="ttdef"><b>Definition:</b> <a href="_cdsso_8php_source.html#l00029">Cdsso.php:29</a></div></div>
<div class="ttc" id="class_domainmap___plugin_html"><div class="ttname"><a href="class_domainmap___plugin.html">Domainmap_Plugin</a></div><div class="ttdef"><b>Definition:</b> <a href="_plugin_8php_source.html#l00029">Plugin.php:29</a></div></div>
<div class="ttc" id="class_domainmap___module_html_ac6e69e0204c5c06d40472da862ece36b"><div class="ttname"><a href="class_domainmap___module.html#ac6e69e0204c5c06d40472da862ece36b">Domainmap_Module\get_main_ajax_url</a></div><div class="ttdeci">get_main_ajax_url()</div><div class="ttdef"><b>Definition:</b> <a href="_module_8php_source.html#l00275">Module.php:275</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_0560c4a4c6149ff4802773baa71c0d22.html">OneDrive</a></li><li class="navelem"><a class="el" href="dir_2118a8f33e94722cef96827f3801fee3.html">wpms.network</a></li><li class="navelem"><a class="el" href="dir_8943648afa701a01942f58e6b8f8f698.html">CurrentSetup</a></li><li class="navelem"><a class="el" href="dir_f802b33df1f3bf73960f7b6a01d62693.html">wp-content</a></li><li class="navelem"><a class="el" href="dir_d458f8ab865d077adc9c10df3001dda7.html">plugins</a></li><li class="navelem"><a class="el" href="dir_843128821777c4d026ade0567c7bff1d.html">domain-mapping</a></li><li class="navelem"><a class="el" href="dir_16146d95df0c9964b7e228d6e9003139.html">classes</a></li><li class="navelem"><a class="el" href="dir_4522f486459d1765a14585148fe27356.html">Domainmap</a></li><li class="navelem"><a class="el" href="dir_17f3c1ab06a51406f3d012f50aaaf571.html">Module</a></li><li class="navelem"><a class="el" href="_cdsso_8php.html">Cdsso.php</a></li>
    <li class="footer">Generated on Sun Mar 1 2015 15:16:46 for Domain Mapping 4.3.0.4 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
